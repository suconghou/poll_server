
使用`poll`API实现的单线程异步IO SERVER


案例 

echo server

http server

redis server

http file server


```
g++ -Wall -std=c++20 -O1 main.cpp
```

API 设计

### 构造函数参数

**on_loop**

事件循环持续调用时一直触发，函数需返回一个数字，代表事件循环检测的超时时间，单位毫秒，这使得单线程程序仍然有机会执行一些外部任务

当返回负数时，中断事件循环

**on_open**

当成功`accept`后，回调此函数，并携带参数此链接的`fd`

当系统连接数超过限制（128）后，回调此函数携带的`fd`为-1，代表连接数已满，新链接被关闭

**on_data**

当有数据到达时，回调此函数，并携带参数此链接的`fd`和数据指针，数据长度

调用方必须判断数据长度大于0，才能读取数据buffer

数据长度为0，代表对方关闭链接（recv返回0）

数据长度为-1，代表事件循环收到链接中断（POLLHUP事件）

### 数据发送

使用`write`函数提交一个数据发送请求，参数`fd`,发送的数据，回调函数

回调函数回调的参数：self引用，操作的`fd`, 发送的字节数

当发送字节数为负数时，代表发送失败

当发送的字节数>=0时，代表发送成功,此数字并不一定等于提交的数据长度，因为提交的发送数据可能较大，会分批发送，本回调函数仅在最后一批完成后回调那次的发送数据。


### 链接关闭

在任意回调函数里，可直接使用系统函数`close`直接关闭`fd`


## 性能测试


